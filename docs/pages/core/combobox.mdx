import { Layout } from '@/layout';
import { MDX_DATA } from '@/mdx';
import { ComboboxDemos } from '@mantine/demos';

export default Layout(MDX_DATA.Combobox);

## Usage

`Combobox` provides a set of components and hooks to custom select, multiselect or autocomplete components.
The component is very flexible – you have full control the rendering and logic.

<Demo data={ComboboxDemos.select} />

## Examples

This page contains only a small set of examples, as the full code of the demos is long.
You can find all 50+ examples on a [separate page](/combobox?e=BasicSelect).

## useCombobox hook

`useCombobox` hook provides combobox store. The store contains current state of the component
and handlers to update it. Created store must be passed to the `store` prop of `Combobox`:

```tsx
import { useCombobox, Combobox } from '@mantine/core';

function Demo() {
  const combobox = useCombobox();
  return <Combobox store={combobox}>{/* Your implementation */}</Combobox>;
}
```

## useCombobox options

`useCombobox` hooks accepts an options object with the following properties:

```tsx
interface UseComboboxOptions {
  /** Default value for `dropdownOpened`, `false` by default */
  defaultOpened?: boolean;

  /** Controlled `dropdownOpened` state */
  opened?: boolean;

  /** Called when `dropdownOpened` state changes */
  onOpenedChange?(opened: boolean): void;

  /** Called when dropdown closes with event source: keyboard, mouse or unknown */
  onDropdownClose?(eventSource: ComboboxDropdownEventSource): void;

  /** Called when dropdown opens with event source: keyboard, mouse or unknown */
  onDropdownOpen?(eventSource: ComboboxDropdownEventSource): void;

  /** Determines whether arrow key presses should loop though items (first to last and last to first), `true` by default */
  loop?: boolean;

  /** `behavior` passed down to `element.scrollIntoView`, `'instant'` by default */
  scrollBehavior?: ScrollBehavior;
}
```

You can import `UseComboboxOptions` type from `@mantine/core` package:

```tsx
import type { UseComboboxOptions } from '@mantine/core';
```

## Combobox store

Combobox store is an object with the following properties:

```tsx
interface ComboboxStore {
  /** Current dropdown opened state */
  dropdownOpened: boolean;

  /** Opens dropdown */
  openDropdown(eventSource?: 'keyboard' | 'mouse' | 'unknown'): void;

  /** Closes dropdown */
  closeDropdown(eventSource?: 'keyboard' | 'mouse' | 'unknown'): void;

  /** Toggles dropdown opened state */
  toggleDropdown(eventSource?: 'keyboard' | 'mouse' | 'unknown'): void;

  /** Selected option index */
  selectedOptionIndex: number;

  /** Selects `Combobox.Option` by index */
  selectOption(index: number): void;

  /** Selects first `Combobox.Option` with `active` prop.
   *  If there are no such options, the function does nothing.
   */
  selectActiveOption(): string | null;

  /** Selects first `Combobox.Option` that is not disabled.
   *  If there are no such options, the function does nothing.
   * */
  selectFirstOption(): string | null;

  /** Selects next `Combobox.Option` that is not disabled.
   *  If the current option is the last one, the function selects first option, if `loop` is true.
   */
  selectNextOption(): string | null;

  /** Selects previous `Combobox.Option` that is not disabled.
   *  If the current option is the first one, the function selects last option, if `loop` is true.
   * */
  selectPreviousOption(): string | null;

  /** Resets selected option index to -1, removes `data-combobox-selected` from selected option */
  resetSelectedOption(): void;

  /** Triggers `onClick` event of selected option.
   *  If there is no selected option, the function does nothing.
   */
  clickSelectedOption(): void;

  /** Updates selected option index to currently selected or active option.
   *  The function is required to be used with searchable components to update selected option index
   *  when options list changes based on search query.
   */
  updateSelectedOptionIndex(target?: 'active' | 'selected'): void;

  /** List id, used for `aria-*` attributes */
  listId: string | null;

  /** Sets list id */
  setListId(id: string): void;

  /** Ref of `Combobox.Search` input */
  searchRef: React.MutableRefObject<HTMLInputElement | null>;

  /** Moves focus to `Combobox.Search` input */
  focusSearchInput(): void;

  /** Ref of the target element */
  targetRef: React.MutableRefObject<HTMLElement | null>;

  /** Moves focus to the target element */
  focusTarget(): void;
}
```

You can import `ComboboxStore` type from `@mantine/core` package:

```tsx
import type { ComboboxStore } from '@mantine/core';
```

## useCombobox handlers

Combobox store handlers can be used to control `Combobox` state.
For example, to open dropdown, call `openDropdown` handler:

```tsx
import { useCombobox, Combobox, Button } from '@mantine/core';

function Demo() {
  const combobox = useCombobox();

  return (
    <Combobox>
      <Combobox.Target>
        <Button onClick={() => combobox.openDropdown()}>Open dropdown</Button>
      </Combobox.Target>

      {/* Your implementation */}
    </Combobox>
  );
}
```

You can use store handlers in `useCombobox` options. For example, you can
call `selectFirstOption` when the dropdown is opened and `resetSelectedOption`
when it is closed:

```tsx
import { useCombobox, Combobox } from '@mantine/core';

function Demo() {
  const combobox = useCombobox({
    onDropdownOpen: () => combobox.selectFirstOption(),
    onDropdownClose: () => combobox.resetSelectedOption(),
  });

  return <Combobox store={combobox}>{/* Your implementation */}</Combobox>;
}
```

## Autocomplete example

<Demo data={ComboboxDemos.autocomplete} />

## Searchable select example

<Demo data={ComboboxDemos.searchableSelect} />

> **Different between searchable select and autocomplete**
>
> Autocomplete suggests options based on the user input, but does not enforce
> any of of options to be picked – user can type anything and submit it.
> Searchable select only allows to pick one of the options, it does not allow
> to submit any other value – if the value is not in the list, it will be automatically
> replaced with the previously selected option.

## Multiselect example

<Demo data={ComboboxDemos.multiselect} />

## Searchable multiselect example

<Demo data={ComboboxDemos.searchableMultiselect} />

## Target element

You can use any element as target for combobox, it will be used to position
the dropdown. To make component accessible, use focusable element as target:
`input`, `textarea` or `button`.

Example of using [Button](/core/button) as a target:

<Demo data={ComboboxDemos.button} />

## Search input

If you prefer to have search input inside the dropdown, use `Combobox.Search` component.
To focus the search input, call `combobox.focusSearchInput`, usually it is done
when the dropdown is opened. To prevent focus loss after the dropdown is closed,
call `combobox.focusTarget`:

<Demo data={ComboboxDemos.buttonSearch} />

## Select first option

Use `combobox.selectFirstOption` function to select first option. It is useful
if you want to select first option when user searching for options in the list.
If there are not options available, it will do nothing.

<Demo data={ComboboxDemos.selectFirstOption} />

## Active option

Set `active` prop on `Combobox.Option` component to mark it as active.
By default, active option does not have any styles, you can use `data-combobox-active`
[data attribute](/styles/data-attributes) to style it.

`combobox.selectActiveOption` function selects active option. Usually, it is called
when the dropdown is opened:

<Demo data={ComboboxDemos.activeOption} />

## Scrollable list

Set `max-height` style on either `Combobox.Dropdown` or `Combobox.Options` to make
options list scrollable. You can use `mah` [style prop](/styles/style-props) to set
`max-height`.

<Demo data={ComboboxDemos.nativeScroll} />

## Scrollable list with ScrollArea

You can also use [ScrollArea or ScrollArea.Autosize](/core/scroll-area) components
instead of native scrollbars:

<Demo data={ComboboxDemos.scrollArea} />

## Hide dropdown

Set `hidden` prop on `Combobox.Dropdown` to hide the dropdown. For example,
it can be useful when you want to show the dropdown only when there is at least
one option available:

<Demo data={ComboboxDemos.hiddenDropdown} />

## Control dropdown opened state

To control dropdown opened state, pass `opened` to `useCombobox` hook:

<Demo data={ComboboxDemos.controlledDropdown} />

## Without dropdown

You can use `Combobox` without dropdown. To do so, use `Combobox.EventsTarget` instead
of `Combobox.Target`:

<Demo data={ComboboxDemos.noDropdown} />
